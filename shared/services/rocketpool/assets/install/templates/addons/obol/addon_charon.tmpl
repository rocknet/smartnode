# Autogenerated - DO NOT MODIFY THIS FILE DIRECTLY 
# If you want to overwrite some of these values with your own customizations,
# please add them to `override/addon_obol.yml`.
# 
# See https://docs.docker.com/compose/extends/#adding-and-overriding-configuration
# for more information on overriding specific parameters of docker-compose files.

services:
  addon_charon:
    image: {{.Obol.GetContainerTag}}
    user: root
    container_name: {{.Smartnode.ProjectName}}_addon_charon
    restart: unless-stopped
    volumes:
      - {{.RocketPoolDirectory}}/addons/obol:/opt/charon/.charon
    networks:
      - net
    ports:
      # P2P port for Charon peer communication
      - "{{.Obol.GetP2PPort}}:3610/tcp"
    environment:
      # Point Charon to the beacon node
      - CHARON_BEACON_NODE_ENDPOINTS={{.ConsensusClientApiUrl}}
      # Point Charon to the execution client
      - CHARON_EXECUTION_CLIENT_RPC_ENDPOINT={{.GetEcHttpEndpoint}}
      # Validator client will connect to Charon on this address
      - CHARON_VALIDATOR_API_ADDRESS=0.0.0.0:3600
      # Log level
      - CHARON_LOG_LEVEL=info
      # Log format
      - CHARON_LOG_FORMAT=console
      # Monitoring endpoints
      - CHARON_MONITORING_ADDRESS=0.0.0.0:3620
      # P2P configuration
      - CHARON_P2P_TCP_ADDRESS=0.0.0.0:{{.Obol.GetP2PPort}}
      # Builder API (MEV-Boost)
      - CHARON_BUILDER_API={{.EnableMevBoost.Value}}
      {{- if eq .ConsensusClient.String "nimbus"}}
      # Feature flags for Nimbus compatibility
      - CHARON_FEATURE_SET_ENABLE=json_requests
      {{- end}}
    healthcheck:
      test: wget -qO- http://localhost:3620/readyz
    cap_drop:
      - all
    cap_add:
      - NET_BIND_SERVICE
    security_opt:
      - no-new-privileges

networks:
  net:
